/*
Copyright (c) 2019 Daybrush
name: @scena/ruler
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/ruler.git
version: 0.9.1
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Ruler=e()}(this,function(){"use strict";var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function o(e,n){return function(t){t&&(e[n]=t)}}var _=function(){function t(){this.keys=[],this.values=[]}var e=t.prototype;return e.get=function(t){return this.values[this.keys.indexOf(t)]},e.set=function(t,e){var n=this.keys,r=this.values,i=n.indexOf(t),o=-1===i?n.length:i;n[o]=t,r[o]=e},t}(),g=function(){function t(){this.object={}}var e=t.prototype;return e.get=function(t){return this.object[t]},e.set=function(t,e){this.object[t]=e},t}(),b="function"==typeof Map,s=function(){function t(){}var e=t.prototype;return e.connect=function(t,e){this.prev=t,this.next=e,t&&(t.next=this),e&&(e.prev=this)},e.disconnect=function(){var t=this.prev,e=this.next;t&&(t.next=e),e&&(e.prev=t)},e.getIndex=function(){for(var t=this,e=-1;t;)t=t.prev,++e;return e},t}();var O=function(){function t(t,e,n,r,i,o,s,u){this.prevList=t,this.list=e,this.added=n,this.removed=r,this.changed=i,this.maintained=o,this.changedBeforeAdded=s,this.fixed=u}var e=t.prototype;return Object.defineProperty(e,"ordered",{get:function(){return this.cacheOrdered||this.caculateOrdered(),this.cacheOrdered},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pureChanged",{get:function(){return this.cachePureChanged||this.caculateOrdered(),this.cachePureChanged},enumerable:!0,configurable:!0}),e.caculateOrdered=function(){var t=function(t,n){var u=[],a=[];return t.forEach(function(t){var e=t[0],n=t[1],r=new s;u[e]=r,a[n]=r}),u.forEach(function(t,e){t.connect(u[e-1])}),t.filter(function(t,e){return!n[e]}).map(function(t,e){var n=t[0],r=t[1];if(n===r)return[0,0];var i=u[n],o=a[r-1],s=i.getIndex();return i.disconnect(),o?i.connect(o,o.next):i.connect(void 0,u[0]),[s,i.getIndex()]})}(this.changedBeforeAdded,this.fixed),u=this.changed,a=[];this.cacheOrdered=t.filter(function(t,e){var n=t[0],r=t[1],i=u[e],o=i[0],s=i[1];if(n!==r)return a.push([o,s]),!0}),this.cachePureChanged=a},t}();function c(t,e,n){var r=b?Map:n?g:_,i=n||function(t){return t},o=[],s=[],u=[],a=t.map(i),c=e.map(i),f=new r,h=new r,p=[],l=[],d={},v=[],y=0,m=0;return a.forEach(function(t,e){f.set(t,e)}),c.forEach(function(t,e){h.set(t,e)}),a.forEach(function(t,e){var n=h.get(t);void 0===n?(++m,s.push(e)):d[n]=m}),c.forEach(function(t,e){var n=f.get(t);void 0===n?(o.push(e),++y):(u.push([n,e]),m=d[e]||0,p.push([n-m,e-y]),l.push(e===n),n!==e&&v.push([n,e]))}),s.reverse(),new O(t,e,o,s,v,u,p,l)}var e="string",u="number",a="undefined";function f(t){return typeof t===e}function d(t,r){return void 0===r&&(r="-"),t.replace(/([a-z])([A-Z])/g,function(t,e,n){return""+e+r+n.toLowerCase()})}var h=function(t,e){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function p(t,e){function n(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var l=function(){return(l=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function v(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function y(t,e){if(t===e)return!1;for(var n in t)if(!(n in e))return!0;for(var n in e)if(t[n]!==e[n])return!0;return!1}function m(i,o){var s=Object.keys(i),n=Object.keys(o),t=c(s,n,function(t){return t}),r={},u={},a={};return t.added.forEach(function(t){var e=n[t];r[e]=o[e]}),t.removed.forEach(function(t){var e=s[t];u[e]=i[e]}),t.maintained.forEach(function(t){var e=t[0],n=s[e],r=[i[n],o[n]];i[n]!==o[n]&&(a[n]=r)}),{added:r,removed:u,changed:a}}function w(t){t.forEach(function(t){t()})}function n(t){var e=0;return t.map(function(t){return null==t?"$compat"+ ++e:""+t})}function E(t,e,n,r){return f(t)||function(t){return typeof t===u}(t)?new L("text_"+t,e,n,r,null,{}):new("string"==typeof t.type?z:t.type.prototype.render?T:$)(t.type,e,n,r,t.ref,t.props)}function x(t){var e=[];return t.forEach(function(t){e=e.concat(function(t){return Array.isArray(t)}(t)?x(t):t)}),e}function P(t){var e=t.className,n=v(t,["className"]);return null!=e&&(n.class=e),delete n.style,delete n.children,n}function S(t,e){if(!e)return t;for(var n in e)typeof t[n]===a&&(t[n]=e[n]);return t}function j(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=e||{},o=i.key,s=i.ref,u=v(i,["key","ref"]);return{type:t,key:o,ref:s,props:l(l({},u),{children:x(n).filter(function(t){return null!=t&&!1!==t})})}}var t=function(){function t(t,e,n,r,i,o){void 0===o&&(o={}),this.type=t,this.key=e,this.index=n,this.container=r,this.ref=i,this.props=o,this._providers=[]}var e=t.prototype;return e._should=function(t,e){return!0},e._update=function(t,e,n,r){if(this.base&&!f(e)&&!r&&!this._should(e.props,n))return!1;this.original=e,this._setState(n);var i=this.props;return f(e)||(this.props=e.props,this.ref=e.ref),this._render(t,this.base?i:{},n),!0},e._mounted=function(){var t=this.ref;t&&t(this.base)},e._setState=function(t){},e._updated=function(){var t=this.ref;t&&t(this.base)},e._destroy=function(){var t=this.ref;t&&t(null)},t}();function C(t){var e={},n={};for(var r in t)0===r.indexOf("on")?n[r.replace("on","").toLowerCase()]=t[r]:e[r]=t[r];return{attributes:e,events:n}}var L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}p(e,t);var n=e.prototype;return n._render=function(t){var e=this,n=!this.base;return n&&(this.base=document.createTextNode(this.type.replace("text_",""))),t.push(function(){n?e._mounted():e._updated()}),!0},n._unmount=function(){this.base.parentNode.removeChild(this.base)},e}(t),z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.events={},t._isSVG=!1,t}p(t,e);var n=t.prototype;return n.addEventListener=function(t,e){var n=this.events;n[t]=function(t){t.nativeEvent=t,e(t)},this.base.addEventListener(t,n[t])},n.removeEventListener=function(t){var e=this.events;this.base.removeEventListener(t,e[t]),delete e[t]},n._should=function(t){return y(this.props,t)},n._render=function(t,e){var n=this,r=!this.base;if(r){var i=this._hasSVG();this._isSVG=i;var o=this.props.portalContainer;if(!o){var s=this.type;o=i?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s)}this.base=o}W(this,this._providers,this.props.children,t,null);var u=this.base,a=C(e),c=a.attributes,f=a.events,h=C(this.props),p=h.attributes,l=h.events;return function(t,e,n){var r=m(t,e),i=r.added,o=r.removed,s=r.changed;for(var u in i)n.setAttribute(u,i[u]);for(var u in s)n.setAttribute(u,s[u][1]);for(var u in o)n.removeAttribute(u)}(P(c),P(p),u),function(t,e,n){var r=m(t,e),i=r.added,o=r.removed,s=r.changed;for(var u in o)n.removeEventListener(u);for(var u in i)n.addEventListener(u,i[u]);for(var u in s)n.removeEventListener(u),n.addEventListener(u,s[u][1]);for(var u in o)n.removeEventListener(u)}(f,l,this),function(t,e,n){var r=n.style,i=m(t,e),o=i.added,s=i.removed,u=i.changed;for(var a in o){var c=d(a,"-");r.setProperty?r.setProperty(c,o[a]):r[c]=o[a]}for(var a in u){c=d(a,"-");r.setProperty?r.setProperty(c,u[a][1]):r[c]=u[a][1]}for(var a in s){c=d(a,"-");r.removeProperty?r.removeProperty(c):r[c]=""}}(e.style||{},this.props.style||{},u),t.push(function(){r?n._mounted():n._updated()}),!0},n._unmount=function(){var t=this.events,e=this.base;for(var n in t)e.removeEventListener(n,t[n]);this._providers.forEach(function(t){t._unmount()}),this.events={},this.props.portalContainer||e.parentNode.removeChild(e)},n._hasSVG=function(){if(this._isSVG||"svg"===this.type)return!0;var t=A(this.container);return t&&"ownerSVGElement"in t},t}(t);function A(t){if(!t)return null;var e=t.base;return e instanceof Node?e:A(t.container)}function R(t){if(!t)return null;if(t instanceof Node)return t;var e=t.$_provider._providers;return e.length?R(e[0].base):null}var $=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}p(e,t);var n=e.prototype;return n._render=function(t){var e=this.type(this.props);return W(this,this._providers,e?[e]:[],t),!0},n._unmount=function(){this._providers.forEach(function(t){t._unmount()})},e}(t),M=function(n){function t(t){var e=n.call(this,"container","container",0,null)||this;return e.base=t,e}p(t,n);var e=t.prototype;return e._render=function(){return!0},e._unmount=function(){},t}(t),T=function(s){function t(t,e,n,r,i,o){return void 0===o&&(o={}),s.call(this,t,e,n,r,i,S(o,t.defaultProps))||this}p(t,s);var e=t.prototype;return e._should=function(t,e){return this.base.shouldComponentUpdate(S(t,this.type.defaultProps),e||this.base.state)},e._render=function(t,e,n){var r=this;this.props=S(this.props,this.type.defaultProps);var i=!this.base;i?(this.base=new this.type(this.props),this.base.$_provider=this):this.base.props=this.props;var o=this.base,s=o.state,u=o.render();u&&u.props&&!u.props.children.length&&(u.props.children=this.props.children),W(this,this._providers,u?[u]:[],t,n,null),t.push(function(){i?(r._mounted(),o.componentDidMount()):(r._updated(),o.componentDidUpdate(e,s))})},e._setState=function(t){var e=this.base;e&&t&&(e.state=t)},e._unmount=function(){this._providers.forEach(function(t){t._unmount()}),clearTimeout(this.base.$_timer),this.base.componentWillUnmount()},t}(t),k=function(){function t(t){void 0===t&&(t={}),this.props=t,this.state={},this.$_timer=0,this.$_state={}}var e=t.prototype;return e.shouldComponentUpdate=function(t,e){return!0},e.render=function(){return null},e.setState=function(t,e,n){var r=this;this.$_timer||(this.$_state={}),clearTimeout(this.$_timer),this.$_timer=0,this.$_state=l(l({},this.$_state),t),n?this.$_setState(e,n):this.$_timer=setTimeout(function(){r.$_timer=0,r.$_setState(e,n)})},e.forceUpdate=function(t){this.setState({},t,!0)},e.componentDidMount=function(){},e.componentDidUpdate=function(t,e){},e.componentWillUnmount=function(){},e.$_setState=function(t,e){var n=[],r=this.$_provider;W(r.container,[r],[r.original],n,l(l({},this.state),this.$_state),e)&&(t&&n.push(t),w(n))},t}(),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.shouldComponentUpdate=function(t,e){return y(this.props,t)||y(this.state,e)},e}(k),U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}p(e,t);var n=e.prototype;return n.componentDidMount=function(){var t=this.props,e=t.element,n=t.container;this._portalProvider=new M(n),I(e,n,this._portalProvider)},n.componentDidUpdate=function(){var t=this.props;I(t.element,t.container,this._portalProvider)},n.componentWillUnmount=function(){I(null,this.props.container,this._portalProvider),this._portalProvider=null},e}(N);function D(i,s,o){var u=o.map(function(t){return f(t)?null:t.key}),t=c(n(s.map(function(t){return t.key})),n(u),function(t){return t});t.removed.forEach(function(t){s.splice(t,1)[0]._unmount()}),t.ordered.forEach(function(t){var e=t[0],n=t[1],r=s.splice(e,1)[0];s.splice(n,0,r);var i=R(r.base),o=R(s[n+1]&&s[n+1].base);i&&i.parentNode.insertBefore(i,o)}),t.added.forEach(function(t){s.splice(t,0,E(o[t],u[t],t,i))});var e=t.maintained.filter(function(t){t[0];var e=t[1],n=o[e],r=s[e];return(f(n)?"text_"+n:n.type)!==r.type?(r._unmount(),s.splice(e,1,E(n,u[e],e,i)),!0):(r.index=e,!1)});return function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(t.added,e.map(function(t){t[0];return t[1]}))}function W(i,o,n,r,s,u){var t=D(i,o,n),e=o.filter(function(t,e){return t._update(r,n[e],s,u)}),a=A(i);return a&&t.reverse().forEach(function(t){var e=o[t],n=R(e.base);if(n&&a!==n&&!n.parentNode){var r=function(t,e){for(var n=t._providers,r=n.length,i=e.index+1;i<r;++i){var o=R(n[i].base);if(o)return o}return null}(i,e);a.insertBefore(n,r)}}),0<e.length}function I(t,e,n){void 0===n&&(n=e.__REACT_COMPAT__);var r=!!n;return function(t,e,n){var r=[];W(t,t._providers,e,r,n),w(r)}(n=n||new M(e),t?[t]:[]),r||(e.__REACT_COMPAT__=n),n}function G(t,e,n){var r=e.__REACT_COMPAT__;t&&!r&&(e.innerHTML=""),I(t,e,r),n&&n()}var H="function",V="object",B={cm:function(t){return 96*t/2.54},mm:function(t){return 96*t/254},in:function(t){return 96*t},pt:function(t){return 96*t/72},pc:function(t){return 96*t/6},"%":function(t,e){return t*e/100},vw:function(t,e){return void 0===e&&(e=window.innerWidth),t/100*e},vh:function(t,e){return void 0===e&&(e=window.innerHeight),t/100*e},vmax:function(t,e){return void 0===e&&(e=Math.max(window.innerWidth,window.innerHeight)),t/100*e},vmin:function(t,e){return void 0===e&&(e=Math.min(window.innerWidth,window.innerHeight)),t/100*e}};function Y(t,e){var n=function(t){var e=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(t);if(!e)return{prefix:"",unit:"",value:NaN};var n=e[1],r=e[2];return{prefix:n,unit:e[3],value:parseFloat(r)}}(t),r=n.value,i=n.unit;if(function(t){return t&&typeof t===V}(e)){var o=e[i];if(o){if(function(t){return typeof t===H}(o))return o(r);if(B[i])return B[i](r,o)}}else if("%"===i)return r*e/100;return B[i]?B[i](r):r}var F=function(t,e){return(F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var Z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrollPos:0},t.width=0,t.height=0,t}!function(t,e){function n(){this.constructor=t}F(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,e);var n=t.prototype;return n.render=function(){return j("canvas",{ref:o(this,"canvasElement"),style:this.props.style})},n.componentDidMount=function(){var t=this.canvasElement.getContext("2d");this.canvasContext=t,this.resize()},n.componentDidUpdate=function(){this.resize()},n.scroll=function(t){this.draw(t)},n.resize=function(){var t=this.canvasElement,e=this.props,n=e.width,r=e.height,i=e.scrollPos;this.width=n||t.offsetWidth,this.height=r||t.offsetHeight,t.width=2*this.width,t.height=2*this.height,this.draw(i)},n.draw=function(t){void 0===t&&(t=this.state.scrollPos);var e=this.props,n=e,r=n.unit,i=n.zoom,o=n.type,s=n.backgroundColor,u=n.lineColor,a=n.textColor,c=n.direction,f=n.negativeRuler,h=void 0===f||f,p=n.segment,l=void 0===p?10:p,d=n.textFormat,v=n.range,y=void 0===v?[-1/0,1/0]:v,m=this.width,_=this.height;this.state.scrollPos=t;var g=this.canvasContext,b="horizontal"===o,O="start"===c,w=!1!==h,E=e.font||"10px sans-serif",x=e.textAlign||"left",P=e.textOffset||[0,0],S=b?_:m,j=Y(""+(e.mainLineSize||"100%"),S),C=Y(""+(e.longLineSize||10),S),L=Y(""+(e.shortLineSize||7),S);"transparent"===s?g.clearRect(0,0,2*m,2*_):(g.rect(0,0,2*m,2*_),g.fillStyle=s,g.fill()),g.save(),g.scale(2,2),g.strokeStyle=u,g.lineWidth=1,g.font=E,g.fillStyle=a,O&&(g.textBaseline="top"),g.translate(.5,0),g.beginPath();for(var z=b?m:_,A=i*r,R=Math.floor(t*i/A),$=Math.ceil((t*i+z)/A)-R,M=Math.max(["left","center","right"].indexOf(x)-1,-1),T=0;T<=$;++T){var k=T+R;if(w||!(k<0)){for(var N=k*r,U=(N-t)*i,D=0;D<l;++D){var W=U+D/l*A,I=N+D/l*r;if(!(W<0||z<=W||I<y[0]||I>y[1])){var G=0===D?j:D%2==0?C:L,H=b?[W,O?0:_-G]:[O?0:m-G,W],V=H[0],B=H[1],F=b?[V,B+G]:[V+G,B],Z=F[0],q=F[1];g.moveTo(V,B),g.lineTo(Z,q)}}if(!(U<-A||z+r*i<=U||N<y[0]||N>y[1])){var J=b?[U+-3*M,O?17:_-17]:[O?17:m-17,U+3*M],K=J[0],Q=J[1],X=""+N;d&&(X=d(N)),g.textAlign=x,b?g.fillText(X,K+P[0],Q+P[1]):(g.save(),g.translate(K+P[0],Q+P[1]),g.rotate(-Math.PI/2),g.fillText(X,0,0),g.restore())}}}g.stroke(),g.restore()},t.defaultProps={type:"horizontal",zoom:1,width:0,height:0,unit:50,negativeRuler:!0,mainLineSize:"100%",longLineSize:10,shortLineSize:7,segment:10,direction:"end",style:{width:"100%",height:"100%"},backgroundColor:"#333333",font:"10px sans-serif",textColor:"#ffffff",lineColor:"#777777",range:[-1/0,1/0]},t}(N),q=["type","width","height","unit","zoom","style","backgroundColor","lineColor","textColor","direction","textFormat","scrollPos","textAlign","mainLineSize","longLineSize","shortLineSize","negativeRuler","textOffset","font","segment"],J=["scroll","resize"],K=function(n){function t(t){var e=n.call(this,t)||this;return e.state={},e.state=e.props,e}return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,n),t.prototype.render=function(){var t=this.state,e=t.parentElement,n=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(t,["parentElement"]);return function(t,e){return j(U,{element:t,container:e})}(j(Z,i({ref:o(this,"ruler")},n)),e)},t}(k),Q=function(){function t(t,e){void 0===e&&(e={}),this.tempElement=document.createElement("div"),G(j(K,i({ref:o(this,"innerRuler")},e,{parentElement:t})),this.tempElement)}var e=t.prototype;return e.scroll=function(t){this.getRuler().scroll(t)},e.resize=function(){this.getRuler().resize()},e.destroy=function(){G(null,this.tempElement),this.tempElement=null,this.innerRuler=null},e.getRuler=function(){return this.innerRuler.ruler},t=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;0<=u;u--)(i=t[u])&&(s=(o<3?i(s):3<o?i(e,n,s):i(e,n))||s);return 3<o&&s&&Object.defineProperty(e,n,s),s}([function(n,r){return function(t){var e=t.prototype;n.forEach(function(t){r(e,t)})}}(q,function(t,n){Object.defineProperty(t,n,{get:function(){return this.getRuler().props[n]},set:function(t){var e;this.innerRuler.setState(((e={})[n]=t,e))},enumerable:!0,configurable:!0})})],t)}(),X={__proto__:null,default:Q,PROPERTIES:q,METHODS:J};for(var tt in X)Q[tt]=X[tt];return Q});
//# sourceMappingURL=ruler.min.js.map
